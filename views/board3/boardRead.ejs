<%- include ("../common/header") %>
	<script>
		// https://velog.io/@rkio/Javascript-%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C-%EA%B5%AC%ED%98%84
		async function downloadFile(fileUrl) {
			const baseurl = '/board/download';
			const params = {  // 필요한 query params를 {} 형태에 담아준다.
				fileUrl: fileUrl,
			};
			const queryString = new URLSearchParams(params).toString();  // url에 쓰기 적합한 querySting으로 return 해준다. 
			const requrl = `${baseurl}?${queryString}`;   // 완성된 요청 url.
			const link = document.createElement("a");
			// a 태그 클릭시 다운로드 될 파일의 경로이다.
			link.href = requrl;
			// body에 a 태그를 추가한다.
			document.body.appendChild(link);
			// a 태그를 강제로 클릭한다.
			link.click();
			// a 태그를 제거한다.
			link.remove();
			// 생성했던 url도 제거해준다.
			window.URL.revokeObjectURL(requrl);
		}
	</script>
	<h2>게시글 보기</h2>
	<div class="col-md-12">
		<form id="form_posts" action="" method="post">
			<div class="form-group">
				<label for="id">작성일시</label>
				<input type="text" class="form-control" id="id" value="<%=row.brddate%>" readonly>
			</div>
			<div class="form-group">
				<label for="title">제목</label>
				<input type="text" class="form-control" id="title" value="<%=row.brdtitle%>" readonly>
			</div>
			<div class="form-group">
				<label for="author"> 작성자</label>
				<input type="text" class="form-control" id="author" value="<%=row.brdwriter%> (<%=row.brdEmail%>)"
					readonly>
			</div>
			<div class="form-group">
				<label for="content"> 내용</label>
				<textarea class="form-control" id="content" readonly><%=row.brdmemo%></textarea>
			</div>
			<div class="form-group">
				<label for="author"> 첨부파일</label>
				<% if(row.brdFile) { %>
					<input type="button" onclick="downloadFile('<%=row.brdFile%>')" value="다운로드">
					<!-- (row.brdFile).replace(/public/g, '') -->
					<div style="border:1px solid red"><img src="<%=(row.brdFile).substring((row.brdFile).indexOf('public') + 'public'.length)%>" style="width:100%"></div>
					<% }else{ %>
						[없음]
						<% } %>
			</div>
			<a href="#" onclick="history.back(-1)" role="button" class="btn btn-secondary">취소</a>
			<!-- 보안때문에 post 로 변경 
				<a href="boardDelete?brdno=<%=row.brdno%>" class="btn btn-danger">삭제</a> 
				<a href="boardForm?brdno=<%=row.brdno%>" class="btn btn-success">수정</a>
			-->
			<input type="hidden" name="brdno" value="<%=row.brdno%>">
			<button class="btn btn-success btn-delete">삭제</button>
			<button class="btn btn-success btn-update">수정</button>
		</form>
	</div>
	<script>
		var theForm = $('#form_posts')[0];
		$('.btn-update').on('click', function () {
			theForm.action = "boardForm";
			theForm.submit();
		})
		$('.btn-delete').on('click', function () {
			theForm.action = "boardDelete";
			theForm.submit();
		})
	</script>
	<%- include ("../common/footer") %>