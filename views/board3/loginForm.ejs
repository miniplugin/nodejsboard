<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script src="http://code.jquery.com/jquery.js"></script>
	<script src="https://accounts.google.com/gsi/client" async defer></script>
	<title>board sample for firebase (Auth)</title>
	<!-- 기술 참조 https://blog.naver.com/dawnflo/222747749486 -->
</head>
<script>
	function parseJwt(token) {
		var base64Url = token.split('.')[1];
		var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
		var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {
			return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
		}).join(''));

		return JSON.parse(jsonPayload);
	}
	function onSignIn() {
		google.accounts.id.initialize({
			client_id: "54081620771-6gn2pmgpnvbptk8o568rmdrfqqg6m2s8.apps.googleusercontent.com",
			callback: handleCredentialResponse
		});
		google.accounts.id.prompt();
	}
	function handleCredentialResponse(response) {
		var decodeJSON = parseJwt(response.credential);
		console.log('Google Auth Response', decodeJSON.email);
		$.ajax({
			url: '/board/loginChk',
			dataType: 'json',
			type: 'POST',
			data: decodeJSON,
			success: function (user) {
				console.log('ajax 성공');
				location.replace(document.referrer);
			}
		});
	}
</script>

<body>
	<input type="button" onclick="onSignIn();" value="구글로그인" /><br>
	<a href="/">홈 바로가기</a>
</body>

</html>